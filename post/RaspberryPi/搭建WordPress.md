## 树莓派搭建Wordpress

1. 安装$php$

   ```bash
   sudo proxychains apt install php php-mysql
   ```
   ```bash
   php -v # 查看php版本
   sudo service php7.x-fpm start # 启动php-fpm服务
   sudo apt install php-fpm # 如果启动服务失败更新php-fpm
   service --status-all # 查看服务启动状态
   ```

   测试php是否成功安装

   ```bash
   sudo mv /var/www/html/index.html /var/www/html/index.html.bak
   sudo vim /var/www/html/index.php
   <?php phpinfo(); ?>
   ```
   刷新浏览器
   ![](img/pi/wordpress-2.png)

   ```bash
   sudo mv /var/www/html/index.php /var/www/html/index.php.bak
   ```
   

   
2. 安装$Apache$

      ```bash
      sudo proxychains apt install apache2 -y
      ```

      安装之后浏览器测试是否成功

      ![](img/pi/wordpress-1.png)

      安装$Nginx$

      ```bash
      sudo apt install nginx
      
      sudo service apache2 stop # 如果安装失败或者重启之后不能正常使用,可能端口占用
      sudo service nginx start
      ```

      登录服务器$ip$查看$nginx$是否正常运行

      ![](img/pi/wordpress-3.png)

      ``` bash
      /var/www/html/ # 显示的html文件的目录
      ```

3. 安装$mysql$

   ```bash
   sudo proxychains apt install mariadb-server
   sudo netstat -tap | grep mysql # 查看mysql是否为 LISTEN
   ```

4. 创建数据库和表

    ```bash
    sudo mysql -u root -p # 登录数据库
    create database wordpress; # 新建数据库名字
    grant all privileges on wordpress.* to 'root'@'localhost' identified by 'Your password'; # 把数据库权限授予root账户
    flush privileges; # 刷新数据库
    ```

5. 安装$Wordpress$
   ```bash
   sudo proxychains wget http://wordpress.org/latest.tar.gz 
   sudo tar -xzvf latest.tar.gz
   sudo cp -r wordpress/* /var/www/html # 可以自定义目录
   ```

6. 配置$Nginx$

   ```
   sudo vim /etc/nginx/sites-available/default
   ## 修改的地方已标记
   ##
   # You should look at the following URL's in order to grasp a solid understanding
   # of Nginx configuration files in order to fully unleash the power of Nginx.
   # https://www.nginx.com/resources/wiki/start/
   # https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
   # https://wiki.debian.org/Nginx/DirectoryStructure
   #
   # In most cases, administrators will remove this file from sites-enabled/ and
   # leave it as reference inside of sites-available where it will continue to be
   # updated by the nginx packaging team.
   #
   # This file will automatically load configuration files provided by other
   # applications, such as Drupal or Wordpress. These applications will be made
   # available underneath a path with that package name, such as /drupal8.
   #
   # Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
   ##
   
   # Default server configuration
   #
   server {
   	listen 80; # 1.使用域名访问,删除默认服务器
   	listen [::]:80;
   	# listen 80 default_server;
   	# listen [::]:80 default_server;
   
   	# SSL configuration
   	#
   	# listen 443 ssl default_server;
   	# listen [::]:443 ssl default_server;
   	#
   	# Note: You should disable gzip for SSL traffic.
   	# See: https://bugs.debian.org/773332
   	#
   	# Read up on ssl_ciphers to ensure a secure configuration.
   	# See: https://bugs.debian.org/765782
   	#
   	# Self signed certs generated by the ssl-cert package
   	# Don't use them in a production server!
   	#
   	# include snippets/snakeoil.conf;
   
   	# root /var/www/html; 
   	root /var/www/sanzo.top; # 2. 修改默认目录
   
   	# Add index.php to the list if you are using PHP
   	# index index.html index.htm index.nginx-debian.html;
   	index index.php index.html index.htm index.nginx-debian.html; # 3. 添加index.php, 支持Wordpress
   
   	# server_name _;
   	server_name sanzo.top; # 4. 替换为自己的域名
   
   	location / {
   		# First attempt to serve request as file, then
   		# as directory, then fall back to displaying a 404.
   		try_files $uri $uri/ =404;
   	}
   
   	# pass PHP scripts to FastCGI server
   	#
   	location ~ \.php$ {  # 取消注释, 支持php
   		include snippets/fastcgi-php.conf;
   	#
   	#	# With php-fpm (or other unix sockets):
   		fastcgi_pass unix:/run/php/php7.3-fpm.sock; # 更改为自己的php版本
   	#	# With php-cgi (or other tcp sockets):
   	#	fastcgi_pass 127.0.0.1:9000;
   	}
   
   	# deny access to .htaccess files, if Apache's document root
   	# concurs with nginx's one
   	#
   	location ~ /\.ht {
   		deny all;
   	}
   }
   
   
   # Virtual Host configuration for example.com
   #
   # You can move that to a different file under sites-available/ and symlink that
   # to sites-enabled/ to enable it.
   #
   #server {
   #	listen 80;
   #	listen [::]:80;
   #
   #	server_name example.com;
   #
   #	root /var/www/example.com;
   #	index index.html;
   #
   #	location / {
   #		try_files $uri $uri/ =404;
   #	}
   #}
   ```
   

   
7. 配置Wordpress

   - Wordpress设置中文
   
      ```bash
   sudo wget https://make.wordpress.org/polyglots/teams/?locale=zh_CN # 下载
   sudo unzip -d /var/www/"directory"/wp-content/languages zh_CN.zip # 解压到wp-content下的languages目录
   sudo vim wp-config.php # 添加配置语句
   define('WPLANG', 'zh_CN' );
      ```
      
   - 修改文件上传大小
   
      ```bash
      sudo vim /etc/php/7.3/fpm/php.ini # 修改php配置
   post_max_size = 200M
      upload_max_filesize = 200M
      sudo service php7.3-fpm restart # 重启服务
      
      sudo vim /etc/nginx/nginx.conf # 修改nginx配置, 在http中添加一行,修改nginx的文件上传大小
      http {
      	...
      	##
      	# set client body size to 50M
      	##
      	client_max_body_size 50M;
      	...
      }	
      sudo service nginx restart # 重启服务
      ```
   
   - 修改Wordpress目录权限
   
     ```bash
     sudo chown -R www-data:www-data /var/www/"directory"
     ```
   
     
   
8. 修改wordpress文件权限

   ```bash
   sudo chown -R www-data: wordpress/.
   ```

9. 常见问题

    - mysql安装失败,可以用它推荐的包 mariadb
    - php-fpm服务启动失败,更新php-fpm重试
    - Nginx启动失败,停止Apache2服务,重启Nginx
    - Wordpress,提示数据库不支持,可能忘记安装php-mysql

​       